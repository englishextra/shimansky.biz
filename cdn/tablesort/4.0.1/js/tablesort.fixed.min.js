!function(t){"use strict";function e(t,o){if(!(this instanceof e))return new e(t,o);if(!t||"TABLE"!==t.tagName)throw new Error("Element must be a table");this.init(t,o||{})}var o=[],s=function(e){var o;return t.CustomEvent&&"function"==typeof t.CustomEvent?o=new CustomEvent(e):(o=document.createEvent("CustomEvent"),o.initCustomEvent(e,!1,!1,void 0)),o},r=function(t){return t.getAttribute("data-sort")||t.textContent||t.innerText||""},n=function(t,e){return t=t.toLowerCase(),e=e.toLowerCase(),t===e?0:e>t?1:-1},i=function(t,e){return function(o,s){var r=t(o.td,s.td);return 0===r?e?s.index-o.index:o.index-s.index:r}};e.extend=function(t,e,s){if("function"!=typeof e||"function"!=typeof s)throw new Error("Pattern and sort must be a function");o.push({name:t,pattern:e,sort:s})},e.prototype={init:function(t,e){var o,s,r,n,i=this;if(i.table=t,i.thead=!1,i.options=e,t.rows&&t.rows.length>0)if(t.tHead&&t.tHead.rows.length>0){for(r=0;r<t.tHead.rows.length;r++)if(t.tHead.rows[r].classList.contains("sort-row")){o=t.tHead.rows[r];break}o||(o=t.tHead.rows[t.tHead.rows.length-1]),i.thead=!0}else o=t.rows[0];if(o){var a=function(){i.current&&i.current!==this&&(i.current.classList.remove("sort-up"),i.current.classList.remove("sort-down")),i.current=this,i.sortTable(this)};for(r=0;r<o.cells.length;r++)n=o.cells[r],n.classList.contains("no-sort")||(n.classList.add("sort-header"),n.tabindex=0,n.addEventListener("click",a,!1),n.classList.contains("sort-default")&&(s=n));s&&(i.current=s,i.sortTable(s))}},sortTable:function(t,e){var a,d=this,l=t.cellIndex,c=n,u="",f=[],h=d.thead?0:1,w=t.getAttribute("data-sort-method"),p=t.getAttribute("data-sort-order");if(d.table.dispatchEvent(s("beforeSort")),e?a=t.classList.contains("sort-up")?"sort-up":"sort-down":(a=t.classList.contains("sort-up")?"sort-down":t.classList.contains("sort-down")?"sort-up":"asc"===p?"sort-down":"desc"===p?"sort-up":d.options.descending?"sort-up":"sort-down",t.classList.remove("sort-down"===a?"sort-up":"sort-down"),t.classList.add(a)),!(d.table.rows.length<2)){if(!w){for(;f.length<3&&h<d.table.tBodies[0].rows.length;)u=r(d.table.tBodies[0].rows[h].cells[l]),u=u.trim(),u.length>0&&f.push(u),h++;if(!f)return}for(h=0;h<o.length;h++)if(u=o[h],w){if(u.name===w){c=u.sort;break}}else if(f.every(u.pattern)){c=u.sort;break}for(d.col=l,h=0;h<d.table.tBodies.length;h++){var b,v=[],m={},g=0,L=0;if(!(d.table.tBodies[h].rows.length<2)){for(b=0;b<d.table.tBodies[h].rows.length;b++)u=d.table.tBodies[h].rows[b],u.classList.contains("no-sort")?m[g]=u:v.push({tr:u,td:r(u.cells[d.col]),index:g}),g++;for("sort-down"===a?(v.sort(i(c,!0)),v.reverse()):v.sort(i(c,!1)),b=0;g>b;b++)m[b]?(u=m[b],L++):u=v[b-L].tr,d.table.tBodies[h].appendChild(u)}}d.table.dispatchEvent(s("afterSort"))}},refresh:function(){void 0!==this.current&&this.sortTable(this.current,!0)}},"undefined"!=typeof module&&module.exports?module.exports=e:t.Tablesort=e}("undefined"!=typeof window?window:this);